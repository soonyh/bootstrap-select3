 /* ========================================================================
  * Select3:
  * 基于bootstrap的dropdown效果的多选插件，带字母分类 *
  * https://github.com/soonyh/bootstrap-select3/
  * ======================================================================== */
(function(Jquery,window,document,undefined){var pluginName="select3",defaults={"url":"","placeholder":"Select",},instance,instances=[];function _getUniqueID(prefix){return prefix+"_"+Math.floor(Math.random()*(new Date()).getTime())}function Plugin(element,options){this.element=element;this.settings=Jquery.extend({},defaults,options,$(element).data());this._defaults=defaults;this._name=pluginName;this.loaded=false;this.init()}Jquery.fn[pluginName]=function(options){this.each(function(){instance=Jquery.data(this,"plugin_"+pluginName);if(!instance){Jquery.data(this,"plugin_"+pluginName,(instance=new Plugin(this,options)))}instances.push(instance)});return this};Jquery.extend(Plugin.prototype,{init:function(){$(this.element).val("");this.settings.placeholder=$(this.element).attr("placeholder")?$(this.element).attr("placeholder"):this.settings.placeholder;this.$container=$("<div>").addClass("select3-container form-control").css("width",$(this.element).width());this.$arrow=$('<span class="select3-arrow"><b></b></span>');this.$placeholder=$('<span class="select3-placeholder">'+this.settings.placeholder+"</span>");this.$choices=$('<ul class="select3-choices"/>').append(this.$placeholder).append(this.$arrow);this.$dropdownContainer=$('<div class="select3-dropdown-container"/>').append('<div class="select3-spinner"/>');this.$container.append(this.$choices);this.$container.append(this.$dropdownContainer);$(this.element).hide().after(this.$container);this.$choices.click(function(e){dropdown(instances[$(".select3-choices").index(this)])})},ajax:function(url){var that=this;if(url==""){that.sourceData=[];return}$.ajax({url:url,type:"get",dataType:"json",async:false,data:{},}).done(function(data){that.sourceData=data;that.loaded=true})},write:function(el){if(!$(el).hasClass("active")){var that=this;$(el).addClass("active");var text=$(el).text(),id=$(el).attr("id"),$choiceLi=$('<li class="select3-search-choice"/>'),$btnClose=$('<a class="select3-search-choice-close" href="javascript:void(0);"/>');$("<div/>").html(text).appendTo($choiceLi);$(this.element).val();$btnClose.attr("data-index",id).bind("click",function(e){e.stopImmediatePropagation();that.remove(this)}).appendTo($choiceLi);if(this.$choices.children("li.select3-search-choice").size()==0){this.$choices.children(".select3-placeholder").remove()}this.$choices.append($choiceLi);this.setValue()}},remove:function(el){$("#"+$(el).data("index")).removeClass("active");$(el).closest(".select3-search-choice").remove();if(this.$choices.children("li.select3-search-choice").size()==0){this.$choices.append(this.$placeholder)}this.setValue()},setValue:function(){var arr=[];$(this.$dropdownContainer).find("a.active").each(function(){arr.push($(this).data("value"))});$(this.element).val(arr.join(","));console.log("当前input值：%s",$(this.element).val())}});function dropdown(context){if(context.loaded==false){context.$nav=$('<ul class="nav nav-tabs"/>');context.$tabContent=$('<div class="tab-content"/>');context.ajax(context.settings.url);$.each(context.sourceData,function(index,value){var _id=_getUniqueID("tab");var _a=$("<a>").attr({"href":"#"+_id,"data-toggle":"tab"}).append(value.type);var _li=$("<li>").append(_a);context.$nav.append(_li);var _div=$("<div>").attr({"id":_id,"class":"tab-pane"});$.each(value.choices,function(index,value){var _oprItem=$("<div>").addClass("opr-item");var letter=$("<span>").addClass("opr-item-letter").html(value.letter);_oprItem.append(letter);$.each(value.oprItems,function(index,value){var _id=_getUniqueID("choice");var _a=$("<a>").attr({"href":"javascript:void(0);","id":_id,"data-value":value.value}).append(value.title).bind("click",function(){context.write(this)});_oprItem.append(_a)});_div.append(_oprItem)});context.$tabContent.append(_div)});context.$dropdownContainer.find(".select3-spinner").remove();context.$dropdownContainer.append(context.$nav);context.$dropdownContainer.append(context.$tabContent)}context.$container.toggleClass("open");context.$nav.children("li:first").addClass("active");context.$tabContent.children(".tab-pane:first").addClass("active")}$(document).on("click",function(e){if($(".select3-container.open").size()==0){return}var index=$(".select3-container").index($(".select3-container.open"));if(!$.contains(instances[index]["$container"][0],e.target)&&e.target.className!="select3-search-choice-close"&&e.target.className!="select3-container form-control open"&&e.target.localName!="b"){$(".select3-container").removeClass("open")}})})(jQuery,window,document);
